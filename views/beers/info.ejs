<% layout('../layouts/boilerplate')%>
<main>
    <div class="allcontent" >
        <div class="menuflex-container">
            <div class="flex-item">
            <p class="new-beer"><%= success %></p>
            </div>
        </div>
        <p class="title" ><%= beer.name %></p>
        <div class="imageblocks" >
            <div>            
                <ul class="menuflex-container" >
                    <li class="flex-item" >ABV - <%= beer.abv%>%</li>
                    <li class="flex-item" >STYLE - <%= beer.style%></li>
                    <li class="flex-item" >IBU - <%= beer.ibu%></li>
                    <li class="flex-item" >DRY HOPS - <%= beer.dryHops%> g/l</li>
                    <li class="flex-item" >STATUS - <%= beer.ontap%></li>
                </ul>
                <br>
                <p class="descriptiontext" ><%= beer.description%></p>
            </div>
        </div>
        <% if(data === 'error'){%>

            <% } else { %> 
                <% let hotSideHops = [] %>
                <% let dryHops = [] %>
                 <% for (let i = 0; i < data.hops.length; i++){ %>
                    <% if (data.hops[i].use === 'Dry Hop'){ %> 
                    <% dryHops.push(data.hops[i]) %>
                    <% } else {%>
                        <% hotSideHops.push(data.hops[i]) %>
                        <% }} %>
                <% let dryHopsList = [] %> 
                <% let hotSideHopsList = [] %> 
                <% for (let i = 0; i < hotSideHops.length; i++){ %>
                       <% hotSideHopsList.push(hotSideHops[i].name)} %>
                <% for (let i = 0; i < dryHops.length; i++){ %>
                        <% dryHopsList.push(dryHops[i].name)} %>
                <% let maltsList = [] %>
                <% for (let i = 0; i < data.malts.length; i++){ %>
                         <% maltsList.push(data.malts[i]) %>
                <% } %>
        <% %> 
        <p class="ingredients" >Hops</p>
        <div class="imageblocks" >
            <div>
            <% if(hotSideHopsList.length > 0){ %> 
                <p class="subtitle" >Bittering / Aroma</p>          
                <ul class="menuflex-container" >
                    <li class="ingredients-flex-item" ><%= hotSideHopsList.join(' - ')%></li>
                </ul>
                <p class="ingredients-flex-item"><%= hotSideHops.map(x => x.amount).reduce((prev, curr) => prev + curr, 0)%>g</p>
                <% } %>
                <% if(dryHopsList.length > 0){ %>  
                <p class="subtitle" >Dry Hops</p>
                <ul class="menuflex-container" >
                    <li class="ingredients-flex-item" ><%= dryHopsList.join(' - ')%></li>
                </ul>
                <p class="ingredients-flex-item"><%= dryHops.map(x => x.amount).reduce((prev, curr) => prev + curr, 0)%>g</p>
                <% } %>
                <br>
            </div>
        </div>
        <p class="ingredients" >Malts</p>
        <div class="imageblocks" >
            <div>            
                <ul class="menuflex-container" >
                    <li class="ingredients-flex-item" >
                        <%= maltsList.map(x => x.supplier + ', ' + x.name + ` ( ${x.amount} kg )`).join(' - ')%></li>
                </ul>
                <br>
            </div>
        </div>
        <p class="ingredients" >Yeast</p>
        <div class="imageblocks" >
            <div>            
                <ul class="menuflex-container" >
                    <li class="ingredients-flex-item" ><%= data.yeast.join(' - ')%></li>
                </ul>
                <br>
            </div>
        </div>

        <% %>
        <% } %> 
        <br>
        
            <% if(currentUser) { %>
            <div class="menuflex-container" > 
                <div class="flex-item">
                <a id="editButton" href="/beers/<%=beer._id %>/edit">Edit Beer</a>
                </div>
                <form class="flex-item" action="/beers/<%=beer._id%>?_method=DELETE" method="POST" >
                    <button id="deleteButton" >Delete Beer</button>
                </form>
                <div class="flex-item">
                    <a class="flex-item" href="/taplist">All Beers</a>
                </div>
            </div>
            <div class="menuflex-container" >
                <div class="flex-item" >
                    <br>
                    <p>brewfather data</p>
                    <p class="descriptiontext" >BF Name = <%= beer.bfName%></p>
                    <p class="descriptiontext" >BF ID =<%= beer.bfId%></p>
                </div>
            </div>
            <% } else { %>
            <div class="menuflex-container" >
            <div class="flex-item">
                <a class="flex-item" href="/taplist">All Beers</a>
            </div>
            </div>
            <% } %> 
        </div>
        <br>
        <br>
        <br>
        <br>
        <br>
    </div>
</main>